var BackgroundScroller=pc.createScript("backgroundScroller");BackgroundScroller.attributes.add("translationAmount",{type:"vec2"});var tag="bgTestTag",bgObjects,planeWidth=9.143,maxX,minX;BackgroundScroller.prototype.initialize=function(){bgObjects=this.app.root.findByTag(tag);this.transX=this.translationAmount.x/=60;var t=bgObjects.length*planeWidth/2;maxX=-1*t,minX=t-this.transX,this.pos=bgObjects[0].getPosition();var s=bgObjects[0].getPosition().x;this.lastBackground=bgObjects[0];for(var a=0;a<bgObjects.length;a++)bgObjects[a].getPosition().x>s&&(this.lastBackground=bgObjects[a],this.rightX=this.lastBackground.getPosition().x)},BackgroundScroller.prototype.update=function(t){if(GameInProgress&&!GameEnded)for(var s=0;s<bgObjects.length;s++){var a=bgObjects[s].getPosition();if(a.x<=maxX){var e=this.lastBackground.position;e.x+=planeWidth,e.x+=this.transX,bgObjects[s].setPosition(e),this.lastBackground=bgObjects[s]}bgObjects[s].translate(this.transX,0,0)}};var ScrollTiles=pc.createScript("scrollTiles");ScrollTiles.prototype.initialize=function(){},ScrollTiles.prototype.update=function(l){};var ButtonStates=pc.createScript("buttonStates");ButtonStates.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),ButtonStates.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),ButtonStates.attributes.add("stuntButtonEvent",{type:"string",default:"ButtonStates:stuntButtonOneEvent",enum:[{stuntButtonOne:"buttonStates:novertrunnion"},{stuntButtonTwo:"buttonStates:rocketPunch"},{stuntButtonThree:"buttonState:heatShield"},{stuntButtonFour:"buttonStateDingleArm"}]}),ButtonStates.prototype.initialize=function(){pc.events.attach(this),this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this)},ButtonStates.prototype.onEnter=function(t){this.hovered=!0,t.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},ButtonStates.prototype.onPress=function(t){t.element.textureAsset=this.activeAsset,this.app.fire(this.stuntButtonEvent,"test")},ButtonStates.prototype.onRelease=function(t){t.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture},ButtonStates.prototype.onLeave=function(t){this.hovered=!1,t.element.textureAsset=this.originalTexture,document.body.style.cursor="default"};var ConsoleLogTest=pc.createScript("consoleLogTest");ConsoleLogTest.attributes.add("stuntButtonEvent",{type:"string",default:"ButtonStates:stuntButtonOneEvent",enum:[{stuntButtonOne:"ButtonStates:stuntButtonOneEvent"},{stuntButtonTwo:"ButtonStates:stuntButtonTwoEvent"},{stuntButtonThree:"ButtonStates:stuntButtonThreeEvent"},{stuntButtonFour:"ButtonStates:stuntButtonFourEvent"}]}),ConsoleLogTest.prototype.initialize=function(){console.log("attaching to "+this.stuntButtonEvent),console.log("testing enum binding to "+this.stuntButtonEvent),this.app.on(this.stuntButtonEvent,function(){console.log(this.stuntButtonEvent+" event fired")},this)};var TestAnimationSm=pc.createScript("testAnimationSm");TestAnimationSm.attributes.add("materialAsset",{type:"asset",assetType:"material"});var stateTime=3;TestAnimationSm.prototype.initialize=function(){this.stateChanged=!1,this.timer=0,this.stuntButtonOneEvent=buttonStateNovertrunnion,console.log(this.stuntButtonOneEvent),this.app.on(this.stuntButtonOneEvent,function(t){this.stateChanged=!0,this.timer=0,console.log(t)},this),this.stuntButtonTwoEvent=buttonStateRocketPunch,this.app.on(this.stuntButtonTwoEvent,function(){this.stateChanged=!0,this.timer=0},this),this.stuntButtonThreeEvent=buttonStateHeatShield,this.app.on(this.stuntButtonThreeEvent,function(){this.stateChanged=!0,this.timer=0},this),this.stuntButtonFourEvent=buttonStateDingleArm,this.app.on(this.stuntButtonFourEvent,function(){this.stateChanged=!0,this.timer=0},this),this.neutralStateEvent=statePrefix+stateNeutral,this.once("destroy",this.onDestroy,this)},TestAnimationSm.prototype.update=function(t){this.stateChanged&&(this.timer<stateTime?this.timer+=t:this.returnToIdleState())},TestAnimationSm.prototype.returnToIdleState=function(){this.timer=0,this.stateChanged=!1,this.materialAsset.resource.diffuse.set(1,1,1,.5),this.materialAsset.resource.update(),this.app.fire(this.neutralStateEvent)},TestAnimationSm.prototype.onDestroy=function(){this.app.off(this.stuntButtonOneEvent),this.app.off(this.stuntButtonTwoEvent),this.app.off(this.stuntButtonThreeEvent),this.app.off(this.stuntButtonFourEvent)};var TestAnimationState=pc.createScript("testAnimationState");TestAnimationState.attributes.add("character",{}),TestAnimationState.attributes.add("color",{type:"string",default:"red",enum:[{red:"red"},{green:"green"},{blue:"blue"},{yellow:"yellow"}]}),TestAnimationState.prototype.initialize=function(){},TestAnimationState.prototype.update=function(e){},TestAnimationState.prototype.enterState=function(){switch(this.color){case"red":console.log("red state entered");break;case"blue":console.log("blue state entered");break;case"green":console.log("green state entered");break;case"yellow":console.log("yellow state entered")}};var EnemyMovement=pc.createScript("enemyMovement");EnemyMovement.attributes.add("minSpeed",{type:"number",default:-1}),EnemyMovement.attributes.add("maxSpeed",{type:"number",default:-3}),EnemyMovement.attributes.add("minAmplitude",{type:"number",default:.1}),EnemyMovement.attributes.add("maxAmplitude",{type:"number",default:.5}),EnemyMovement.prototype.initialize=function(){this.resetEventName=baseEventName+this.entity.name,this.app.off(this.resetEventName),this.amplitude=pc.math.random(this.minAmplitude,this.maxAmplitude),this.time=0,this.originalZ=this.entity.getLocalPosition().z,this.originalZY=this.entity.getLocalPosition().y,this.speed=this.minSpeed,this.app.on(baseEventName+this.entity.name,function(){console.log(baseEventName+this.entity.name)},this),this.app.on(pointScoredEvent,function(e){this.increaseSpeed(e)},this)},EnemyMovement.prototype.update=function(e){if(GameInProgress){this.time+=e;var t=this.entity.getLocalPosition().x+e*this.speed;this.entity.setLocalPosition(t,this.originalZY,this.originalZ)}},EnemyMovement.prototype.increaseSpeed=function(e){this.speed=pc.math.lerp(this.minSpeed,this.maxSpeed,e/pointSpread)};var EnemiesManager=pc.createScript("enemiesManager");EnemiesManager.attributes.add("startX",{type:"number",default:5}),EnemiesManager.attributes.add("endX",{type:"number",default:-5}),EnemiesManager.attributes.add("minWaitTime",{type:"number",default:2}),EnemiesManager.attributes.add("maxWaitTime",{type:"number",default:4});var baseEventName="enemies:reset";EnemiesManager.prototype.initialize=function(){this.enemies=this.entity.children,this.timer=0},EnemiesManager.prototype.update=function(e){this.timer>0?this.timer-=e:this.checkXDistances()},EnemiesManager.prototype.checkXDistances=function(e){for(var t=0;t<this.enemies.length;t++){var i=this.enemies[t].getLocalPosition();if(i.x<this.endX){this.enemies[t].setLocalPosition(this.startX,i.y,i.z),this.timer=pc.math.random(this.minWaitTime,this.maxWaitTime),this.app.fire(baseEventName+this.enemies[t].name);break}}};var Enemy=pc.createScript("enemy");Enemy.attributes.add("obstacleTypeAMaterial",{type:"asset",assetType:"material"}),Enemy.attributes.add("obstacleTypeBMaterial",{type:"asset",assetType:"material"}),Enemy.attributes.add("obstacleTypeCMaterial",{type:"asset",assetType:"material"}),Enemy.attributes.add("obstacleTypeDMaterial",{type:"asset",assetType:"material"}),Enemy.attributes.add("obstacleDisplayPlane",{type:"entity"}),Enemy.prototype.initialize=function(){this.resetEventName=baseEventName+this.entity.name,this.app.off(this.resetEventName),this.obstacleType=obstacleTypeAName,this.entity.collision.on("collisionstart",this.onCollsionStart,this)},Enemy.prototype.update=function(e){},Enemy.prototype.selectType=function(){console.log("resetting "+this.entity.name),this.enemyType=pc.math.random(0,4.5),this.enemyType<1?(this.obstacleDisplayPlane.model.material=this.obstacleTypeCMaterial.resource,this.obstacleDisplayPlane.model.material.update(),this.obstacleType=obstacleTypeCName):this.enemyType<2?(this.obstacleDisplayPlane.model.material=this.obstacleTypeBMaterial.resource,this.obstacleDisplayPlane.model.material.update(),this.obstacleType=obstacleTypeBName):this.enemyType<3?(this.obstacleDisplayPlane.model.material=this.obstacleTypeAMaterial.resource,this.obstacleDisplayPlane.model.material.update(),this.obstacleType=obstacleTypeAName):(this.obstacleDisplayPlane.model.material=this.obstacleTypeDMaterial.resource,this.obstacleDisplayPlane.model.material.update(),this.obstacleType=obstacleTypeDName)},Enemy.prototype.onCollsionStart=function(e){for(var t=e.other.tags.list(),a=0;a<t.length;a++)t[a]===tagPlayer&&this.app.fire(playerHitEvent,this.obstacleType)};var Player=pc.createScript("player");Player.attributes.add("jaiyana",{type:"entity"}),Player.attributes.add("captainCode",{type:"entity"}),Player.attributes.add("rex",{type:"entity"}),Player.attributes.add("edgeX",{type:"entity"}),Player.attributes.add("robbit",{type:"entity"}),Player.prototype.initialize=function(){this.currentState=stateNeutral,this.effect=null,this.stuntButtonOneEvent=buttonStateNovertrunnion,this.app.on(this.stuntButtonOneEvent,function(){this.currentState=obstacleTypeAName},this),this.stuntButtonTwoEvent=buttonStateRocketPunch,this.app.on(this.stuntButtonTwoEvent,function(){this.currentState=obstacleTypeBName},this),this.stuntButtonThreeEvent=buttonStateHeatShield,this.app.on(this.stuntButtonThreeEvent,function(){this.currentState=obstacleTypeCName},this),this.stuntButtonFourEvent=buttonStateDingleArm,this.app.on(this.stuntButtonFourEvent,function(){this.currentState=obstacleTypeDName},this),this.neutralStateEvent=statePrefix+stateNeutral,this.app.on(this.neutralStateEvent,function(){this.currentState=stateNeutral},this),this.app.on(playerHitEvent,function(t,e){this.onObstacleCollision(t,e)},this),this.app.on(gameResetEvent,function(){this.resetGame()},this),this.app.on(sendCharacterSelection,function(t){this.showCharacterSelection(t),console.log("character selection received "+t)},this)},Player.prototype.onObstacleCollision=function(t,e){t===this.currentState?(Score++,this.app.fire(pointScoredEvent,Score),this.app.fire(playerObstacleSuccess,e)):(this.app.fire(playerObstacleFailure,e),this.app.fire(gameOverEvent),this.entity.enabled=!1)},Player.prototype.resetGame=function(){this.entity.enabled=!0,this.currentState=stateNeutral},Player.prototype.showCharacterSelection=function(t){switch(t){case charJaiyana:this.jaiyana.enabled=!0;break;case charCaptain:this.captainCode.enabled=!0;break;case charEdgeX:this.edgeX.enabled=!0;break;case charRobbit:this.robbit.enabled=!0;break;case charRex:this.rex.enabled=!0}},Player.prototype.obstacleSuccess=function(t){};var obstacleTypeAName="Novertrunnion",obstacleTypeBName="RocketPunch",obstacleTypeCName="HeatShield",obstacleTypeDName="DingleArm",stateNeutral="Neutral",statePrefix="state:",midfieldResetPrefix="resetMidfield:",playerHitEvent="player:hitEvent",pointScoredEvent="player:scorePoint",gameOverEvent="player:gameOver",countdownTickEvent="gameManager:countdownTick",altCountdownTick="gameManager:altCountdown",countdownFinishEvent="gameManager:countdownFinish",obstacleSetActivePrefix="obstacles:setActive",obstacleSetInactivePrefix="obstacles:setInactive",playerObstacleSuccess="obstacles:success",playerObstacleFailure="obstacles:failure",gameResetEvent="gameManager:resetGame",obstacleResetExternal="obstacles:externalReset",playerChangeAnimState="player:animStateChange",playerIdleAnim="player:forceIdleAnim",buttonStateNovertrunnion="buttonStates:novertrunnion",buttonStateRocketPunch="buttonStates:rocketPunch",buttonStateHeatShield="buttonState:heatShield",buttonStateDingleArm="buttonStateDingleArm",characterSelectedEvent="character:characterSelected",loadNextScene="scene:loadNewScene",scenePreloadEvents="scene:readyForLoad",sendCharacterSelection="character:sendCharacterSelection",tutorialVideoEnded="tutorial:videoEnded",tutorialVideoStart="tutorial:videoStart",letterKeyPressed="nameInput:letterKeyPressed",nameSubmitted="leaderboard:submitPressed",scoreSubmitTrigged="scoreSubmit:attemptSubmit",showLeaderboard="leaderboard:showLeaderboard",pullLeaderboard="leaderboard:pullInfo",updateLeaderboardEntry="leaderboard:updateEntry",tagEnemies="enemies",tagPlayer="player",tagMidfieldObjects="midfield",tagUISubmitName="uiSubmitName",visTypeSpaceTrash="SpaceTrash",visTypeComet="Comet",visTypeAsteroidField="AsteroidField",visTypeMine="Mine",visTypeBlackHole="BlackHole",visTypeWhiteDwarf="WhiteDwarf",visTypeShips="Ships",scorePrefix="PARSECS | ",gameOverText="WIPEOUT",gameStartMessage="GO!",pressedColor=new pc.Color(.282,.659,.847,1),releasedColor=new pc.Color(.99,.99,1,1),pointSpread=1500,countdownLength=3,startingCharacter="characterRex",charRex="characterRex",charJaiyana="characterJaiyana",charCaptain="characterCaptainCode",charEdgeX="characterEdgeX",charRobbit="characterRobbit",textureReloadURLS=new Array,highScoreName="stellar-wipeout-best-score",lastSentScore="stellar-wipeout-last-score-sent",highScoreLimit=999999,maxScoresToDisplay=10;var DisplayScore=pc.createScript("displayScore");DisplayScore.prototype.initialize=function(){this.app.on(pointScoredEvent,function(t){this.updateScoreText(t)},this),this.once("destroy",this.onDestroy,this)},DisplayScore.prototype.updateScoreText=function(t){var e=t.toFixed();this.entity.element.text=scorePrefix+e},DisplayScore.prototype.onDestroy=function(){this.app.off(pointScoredEvent)};var ShowGameOverText=pc.createScript("showGameOverText");ShowGameOverText.prototype.initialize=function(){this.app.on(gameOverEvent,function(){this.entity.element.text=gameOverText},this),this.app.on(gameResetEvent,function(){this.resetGame()},this)},ShowGameOverText.prototype.resetGame=function(){this.entity.element.text=""};var MidfieldObjects=pc.createScript("midfieldObjects");MidfieldObjects.attributes.add("minX",{type:"number",default:-5,description:"leftmost boundaries for x scrolling"}),MidfieldObjects.attributes.add("maxX",{type:"number",default:5,description:"rightmost boundary for x scrolling"}),MidfieldObjects.attributes.add("speed",{type:"number",default:-2}),MidfieldObjects.prototype.initialize=function(){this.midfieldObjects=this.app.root.findByTag(tagMidfieldObjects)},MidfieldObjects.prototype.update=function(i){if(GameInProgress)for(var e=this.speed*i,t=0;t<this.midfieldObjects.length;t++){var d=this.midfieldObjects[t].getPosition();this.midfieldObjects[t].translate(e,0,0),d.x<this.minX&&(this.midfieldObjects[t].setPosition(this.maxX,d.y,d.z),this.app.fire(midfieldResetPrefix+this.midfieldObjects[t].name))}};var MidfieldDisplay=pc.createScript("midfieldDisplay");MidfieldDisplay.attributes.add("width",{type:"number",default:4}),MidfieldDisplay.prototype.initialize=function(){this.eventName=midfieldResetPrefix+this.entity.name,this.app.on(this.eventName,function(){this.resetMaterials()},this),this.transform=new pc.Vec4},MidfieldDisplay.prototype.resetMaterials=function(){var t,i=1/this.width;this.midfieldType=pc.math.random(0,4.5),t=this.midfieldType<1?0%this.width:this.midfieldType<2?1%this.width:this.midfieldType<3?2%this.wdith:3%this.width,this.transform.set(i,1,t*i,0);var e=this.entity.model.meshInstances;e[0].setParameter("texture_diffuseMapTransform",this.transform.data),e[0].setParameter("texture_emissiveMapTransform",this.transform.data),e[0].setParameter("texture_opacityMapTransform",this.transform.data)};var BombPulse=pc.createScript("bombPulse");BombPulse.attributes.add("materialAsset",{type:"asset",assetType:"material"}),BombPulse.attributes.add("numFrames",{type:"number",default:1,description:"Number of frames to play before looping"}),BombPulse.attributes.add("startFrame",{type:"number",default:0,description:"frame to start animation at"}),BombPulse.attributes.add("endFrame",{type:"number",default:1}),BombPulse.attributes.add("width",{type:"number",default:1,description:"Number of frames wide"}),BombPulse.attributes.add("height",{type:"number",default:1,description:"number of frames high"}),BombPulse.attributes.add("frameRate",{type:"number",default:24,description:"playback frames per second"}),BombPulse.attributes.add("heightOffset",{type:"number",default:0}),BombPulse.attributes.add("widthOffset",{type:"number",default:0}),BombPulse.prototype.initialize=function(){this.materialAsset&&(this.material=this.materialAsset.resource),this.timer=1/this.frameRate,this.frame=this.startFrame,this.transform=new pc.Vec4,this.dx=(1-this.widthOffset)/this.width,this.dy=(1-this.heightOffset)/this.height},BombPulse.prototype.update=function(t){this.timer-=t,this.timer<0&&(this.frame++,this.frame>=this.endFrame&&(this.frame=this.startFrame),this.updateMaterial(this.frame),this.timer=1/this.frameRate)},BombPulse.prototype.updateMaterial=function(t){var e=t%this.width,s=Math.floor(t/this.width),a=this.entity.model.meshInstances;this.transform.set(this.dx,this.dy,e*this.dx,1-this.dy-s*this.dy),a[0].setParameter("texture_diffuseMapTransform",this.transform.data),a[0].setParameter("texture_emissiveMapTransform",this.transform.data),a[0].setParameter("texture_opacityMapTransform",this.transform.data)};var ScrollAway=pc.createScript("scrollAway");ScrollAway.attributes.add("speed",{type:"number",default:-1}),ScrollAway.attributes.add("minX",{type:"number",default:-5}),ScrollAway.attributes.add("startingPosition",{type:"vec3"}),ScrollAway.prototype.initialize=function(){this.app.on(gameResetEvent,function(){this.resetGame()},this)},ScrollAway.prototype.update=function(t){if(GameInProgress){var e=this.speed*t;this.entity.translate(e,0,0),this.entity.getPosition().x<this.minX&&(this.entity.enabled=!1)}},ScrollAway.prototype.resetGame=function(){this.entity.enabled=!0,this.entity.setPosition(this.startingPosition)};var GameManager=pc.createScript("gameManager"),GameInProgress=!1,GameEnded=!1,Score=0;GameManager.attributes.add("scoreMod",{type:"number",default:1.5}),GameManager.prototype.initialize=function(){if(this.personalHighScore=0,localStorage){var e=localStorage.getItem(highScoreName);null!==e&&(this.personalHighScore=parseFloat(e))}this.timer=1,this.countdown=countdownLength+1,GameInProgress=!1,GameEnded=!1,this.app.on(gameOverEvent,function(){GameEnded=!0,Score>this.personalHighScore&&(Score>highScoreLimit?this.personalHighScore=highScoreLimit:this.personalHighScore=Score.toFixed(),localStorage&&localStorage.setItem(highScoreName,this.personalHighScore))},this),this.app.on(gameResetEvent,function(){this.resetGame()},this),this.once("destroy",this.onDestroy,this),this.app.fire(countdownTickEvent,this.countdown)},GameManager.prototype.update=function(e){GameInProgress||GameEnded?GameEnded||(Score+=e*this.scoreMod,this.app.fire(pointScoredEvent,Score)):this.countdown>0?this.timer>0?this.timer-=e:(this.countdown-=1,this.timer=1,this.app.fire(countdownTickEvent,this.countdown)):(GameInProgress=!0,this.app.fire(countdownFinishEvent))},GameManager.prototype.resetGame=function(){Score=0,GameEnded=!1,GameInProgress=!1,this.timer=1,this.countdown=countdownLength+1,this.app.fire(countdownTickEvent,this.countdown),this.app.fire(pointScoredEvent,Score)},GameManager.prototype.onDestroy=function(){Score=0,GameEnded=!1,GameInProgress=!1,this.app.off(gameOverEvent),this.app.off(gameResetEvent)};var CountdownText=pc.createScript("countdownText");CountdownText.prototype.initialize=function(){this.countdownEventSubscribed=!1,this.app.on("invalidEvent",function(t){this.countdownEventSubscribed=!0,this.entity.element.text=t},this),this.countdownFinishEventSubscribed=!1,this.app.on(countdownFinishEvent,function(){this.countdownFinishEventSubscribed=!0,this.entity.element.text=gameStartMessage,this.startHideTextTimer()},this),this.once("destroy",this.onDestroy,this),this.hideTextTimerStarted=!1},CountdownText.prototype.update=function(t){!1===this.countdownEventSubscribed&&this.app.on("invalidEvent",function(t){this.countdownEventSubscribed=!0,this.entity.element.text=t},this),!1===this.countdownFinishEventSubscribed&&this.app.on(countdownFinishEvent,function(){this.countdownFinishEventSubscribed=!0,this.entity.element.text=gameStartMessage,this.startHideTextTimer()},this),!0===this.hideTextTimerStarted&&(this.timer>0?this.timer-=t:(this.hideTextTimerStarted=!1,this.entity.element.text=" "))},CountdownText.prototype.startHideTextTimer=function(){this.hideTextTimerStarted=!0,this.timer=1},CountdownText.prototype.onDestroy=function(){this.app.off("invalidEvent"),this.app.off(countdownFinishEvent)};var ObstacleManager=pc.createScript("obstacleManager");ObstacleManager.attributes.add("startX",{type:"number",default:5}),ObstacleManager.attributes.add("endX",{type:"number",default:-5}),ObstacleManager.attributes.add("minWaitTime",{type:"number",default:2}),ObstacleManager.attributes.add("maxWaitTime",{type:"number",default:5}),ObstacleManager.prototype.initialize=function(){this.inactiveObstacles=this.entity.children,this.activeObstacles=new Array,this.timer=this.maxWaitTime,this.app.on(gameResetEvent,function(){this.resetGame()},this),this.app.on(obstacleResetExternal,function(t){this.resetObject(t)},this)},ObstacleManager.prototype.update=function(t){if(GameInProgress&&!GameEnded){this.timer>0?this.timer-=t:this.spawnObstacle();for(var e=0;e<this.activeObstacles.length;e++)this.activeObstacles[e].getLocalPosition().x<this.endX&&this.despawnObstacle(e)}},ObstacleManager.prototype.onDestroy=function(){this.app.off(gameResetEvent),this.app.off(obstacleResetExternal)},ObstacleManager.prototype.spawnObstacle=function(){if(this.inactiveObstacles.length>0){var t=Math.floor(pc.math.random(0,this.inactiveObstacles.length)),e=this.inactiveObstacles[t];this.inactiveObstacles.splice(t,1),this.activeObstacles.push(e);var a=e.getLocalPosition();e.setLocalPosition(this.startX,a.y,a.z),this.app.fire(obstacleSetActivePrefix+e.name),this.timer=pc.math.lerp(this.maxWaitTime,this.minWaitTime,Score/pointSpread)}},ObstacleManager.prototype.despawnObstacle=function(t){var e=this.activeObstacles[t];this.activeObstacles.splice(t,1),this.inactiveObstacles.push(e);var a=e.getLocalPosition();e.setLocalPosition(this.startX,a.y,a.z),this.app.fire(obstacleSetInactivePrefix+e.name)},ObstacleManager.prototype.resetGame=function(){for(var t=0;t<this.activeObstacles.length;t++)this.despawnObstacle(t);this.timer=this.maxWaitTime},ObstacleManager.prototype.resetObject=function(t){for(var e=0;e<this.activeObstacles.length;e++)t===this.activeObstacles[e]&&this.despawnObstacle(e)};var ObstacleMovement=pc.createScript("obstacleMovement");ObstacleMovement.attributes.add("minSpeed",{type:"number",default:-2}),ObstacleMovement.attributes.add("maxSpeed",{type:"number",default:-8}),ObstacleMovement.attributes.add("stopOnSuccess",{type:"boolean"}),ObstacleMovement.attributes.add("stopOnFailure",{type:"boolean"}),ObstacleMovement.attributes.add("visualType",{type:"string",enum:[{SpaceTrash:"SpaceTrash"},{Comet:"Comet"},{AsteroidField:"AsteroidField"},{Mine:"Mine"},{BlackHole:"BlackHole"},{WhiteDwarf:"WhiteDwarf"},{Ships:"Ships"}]}),ObstacleMovement.prototype.postInitialize=function(){this.isActive=!1,this.setActiveEventName=obstacleSetActivePrefix+this.entity.name,this.setInactiveEventName=obstacleSetInactivePrefix+this.entity.name,this.speed=this.minSpeed,this.originalY=this.entity.getLocalPosition().y,this.originalZ=this.entity.getLocalPosition().z,this.movementStopped=!1,this.app.on(this.setActiveEventName,function(){this.setActive()},this),this.app.on(this.setInactiveEventName,function(){this.setInactive()},this),this.app.on(pointScoredEvent,function(t){this.increaseSpeed(t)},this),!0===this.stopOnSuccess&&this.app.on(playerObstacleSuccess,function(t){this.visualType===t&&this.stopMovement()},this),!0===this.stopOnFailure&&this.app.on(playerObstacleFailure,function(t){this.visualType===t&&this.stopMovement()},this)},ObstacleMovement.prototype.update=function(t){this.isActive&&!this.movementStopped&&this.move(t)},ObstacleMovement.prototype.setActive=function(){this.isActive=!0,this.movementStopped=!1},ObstacleMovement.prototype.setInactive=function(){this.isActive=!1},ObstacleMovement.prototype.increaseSpeed=function(t){this.speed=pc.math.lerp(this.minSpeed,this.maxSpeed,t/pointSpread)},ObstacleMovement.prototype.move=function(t){var e=this.entity.getLocalPosition().x+this.speed*t;this.entity.setLocalPosition(e,this.originalY,this.originalZ)},ObstacleMovement.prototype.stopMovement=function(){this.movementStopped=!0};var Obstacle=pc.createScript("obstacle");Obstacle.attributes.add("obstacleType",{type:"string",enum:[{Novertrunnion:"Novertrunnion"},{RocketPunch:"RocketPunch"},{HeatShield:"HeatShield"},{DingleArm:"DingleArm"}]}),Obstacle.attributes.add("visualType",{type:"string",enum:[{SpaceTrash:"SpaceTrash"},{Comet:"Comet"},{AsteroidField:"AsteroidField"},{Mine:"Mine"},{BlackHole:"BlackHole"},{WhiteDwarf:"WhiteDwarf"},{Ships:"Ships"}]}),Obstacle.prototype.initialize=function(){switch(this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.obstacleType){case obstacleTypeAName:case obstacleTypeBName:case obstacleTypeDName:this.entity.collision.on("collisionend",this.onCollisionEnd,this)}},Obstacle.prototype.onCollisionStart=function(t){for(var e=t.other.tags.list(),i=0;i<e.length;i++)e[i]===tagPlayer&&this.app.fire(playerHitEvent,this.obstacleType,this.visualType)},Obstacle.prototype.onCollisionEnd=function(t){for(var e=t.tags.list(),i=0;i<e.length;i++)e[i]==tagPlayer&&this.app.fire(playerIdleAnim)};var RotateObject=pc.createScript("rotateObject");RotateObject.attributes.add("rotationSpeed",{type:"number",default:-50}),RotateObject.prototype.update=function(t){this.entity.rotateLocal(0,this.rotationSpeed*t,0)};var Effect=pc.createScript("effect");Effect.prototype.initialize=function(){this.entity.enabled=!1,console.log("effect "+this.entity.name+" initialized")};var ResetButton=pc.createScript("resetButton");ResetButton.prototype.initialize=function(){this.app.on(gameOverEvent,function(){this.entity.enabled=!0},this),pc.events.attach(this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onRelease,this),this.entity.enabled=!1},ResetButton.prototype.onPress=function(){this.app.fire(gameResetEvent),this.entity.enabled=!1};var ChangeScenes=pc.createScript("changeScenes");ChangeScenes.prototype.initialize=function(){},ChangeScenes.prototype.update=function(e){};var SceneLoadButton=pc.createScript("sceneLoadButton");SceneLoadButton.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),SceneLoadButton.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),SceneLoadButton.attributes.add("sceneToLoad",{type:"number",default:0}),SceneLoadButton.prototype.initialize=function(){pc.events.attach(this),this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onRelease,this)},SceneLoadButton.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},SceneLoadButton.prototype.onPress=function(e){e.element.textureAsset=this.activeAsset,this.app.fire(loadNextScene,this.sceneToLoad)},SceneLoadButton.prototype.onRelease=function(e){e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture};var IntroBackgroundScroller=pc.createScript("introBackgroundScroller");IntroBackgroundScroller.attributes.add("translationAmount",{type:"vec2"});var introTag="introBG",bgObjects,planeWidth=9.143,maxX,minX;IntroBackgroundScroller.prototype.initialize=function(){bgObjects=this.app.root.findByTag(introTag);this.transX=this.translationAmount.x/=60;var t=bgObjects.length*planeWidth/2;maxX=-1*t,minX=t-this.transX,this.pos=bgObjects[0].getPosition();var o=bgObjects[0].getPosition().x;this.lastBackground=bgObjects[0];for(var r=0;r<bgObjects.length;r++)bgObjects[r].getPosition().x>o&&(this.lastBackground=bgObjects[r],this.rightX=this.lastBackground.getPosition().x)},IntroBackgroundScroller.prototype.update=function(t){for(var o=0;o<bgObjects.length;o++){if(bgObjects[o].getPosition().x<=maxX){var r=this.lastBackground.position;r.x+=planeWidth,r.x+=this.transX,bgObjects[o].setPosition(r),this.lastBackground=bgObjects[o]}bgObjects[o].translate(this.transX,0,0)}};var CharacterSelectButton=pc.createScript("characterSelectButton");CharacterSelectButton.attributes.add("characterName",{type:"string",enum:[{rex:"characterRex"},{jaiyana:"characterJaiyana"},{captainCode:"characterCaptainCode"},{edgeX:"characterEdgeX"},{robbit:"characterRobbit"}]}),CharacterSelectButton.prototype.initialize=function(){pc.events.off(this),this.entity.element.off("mousedown"),this.entity.element.off("touchstart"),this.app.off(characterSelectedEvent)},CharacterSelectButton.prototype.postInitialize=function(){pc.events.attach(this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("touchstart",this.onPress,this),this.app.on(characterSelectedEvent,function(t){this.onCharacterSelected(t)},this),console.log("entity name: "+this.entity.element.name)},CharacterSelectButton.prototype.onPress=function(){this.app.fire(characterSelectedEvent,this.characterName)},CharacterSelectButton.prototype.onCharacterSelected=function(t){t===this.characterName?this.entity.element.opacity=1:this.entity.element.opacity=0};var CharacterPreview=pc.createScript("characterPreview");CharacterPreview.attributes.add("characterName",{type:"string",enum:[{rex:"characterRex"},{jaiyana:"characterJaiyana"},{captainCode:"characterCaptainCode"},{edgeX:"characterEdgeX"},{robbit:"characterRobbit"}]}),CharacterPreview.prototype.postInitialize=function(){this.app.on(characterSelectedEvent,function(e){this.togglePreview(e)},this),this.characterName!==startingCharacter&&(this.entity.enabled=!1)},CharacterPreview.prototype.togglePreview=function(e){e===this.characterName?this.entity.enabled=!0:this.entity.enabled=!1};var LoadScene=pc.createScript("loadScene");LoadScene.attributes.add("sceneID",{type:"string",default:"0",title:"Scene ID to load"}),LoadScene.attributes.add("loadOnEvent",{type:"boolean"}),LoadScene.attributes.add("loadEvent",{type:"string"}),LoadScene.prototype.initialize=function(){this.app.off(loadNextScene),this.app.off(scenePreloadEvents),this.sceneToLoad=this.sceneID},LoadScene.prototype.postInitialize=function(){var e=this;this.app.on(loadNextScene,function(t){0!==t&&(this.sceneToLoad=t),setTimeout(function(){e.changeScene()},1e3)},this),this.app.on(characterSelectedEvent,function(e){characterToLoad=e},this),this.loadOnEvent&&this.app.once(this.loadEvent,function(){this.app.fire(loadNextScene,0),this.loadingScene=!0},this),this.loadingScene=!1,characterToLoad=startingCharacter},LoadScene.prototype.update=function(e){this.app.keyboard.isPressed(pc.KEY_SPACE)&&!1===this.loadingScene&&(this.app.fire(loadNextScene),this.loadingScene=!0)},LoadScene.prototype.changeScene=function(){var e=this.app.root.findByName("Root");this.app.fire(scenePreloadEvents),this.loadNewScene(this.sceneToLoad,function(){e.destroy(),pc.app.fire(sendCharacterSelection,characterToLoad)})},LoadScene.prototype.loadNewScene=function(e,t){var n=e+".json";this.app.loadSceneHierarchy(n,function(e,n){e?console.log(e):t(n)})};var MineAnimator=pc.createScript("mineAnimator");MineAnimator.attributes.add("materialAsset",{type:"asset",assetType:"material"}),MineAnimator.attributes.add("numFrames",{type:"number",default:1,description:"Number of frames to play before looping"}),MineAnimator.attributes.add("idleStartFrame",{type:"number",default:0,description:"frame to start animation at"}),MineAnimator.attributes.add("idleEndFrame",{type:"number",default:1}),MineAnimator.attributes.add("explosionStartFrame",{type:"number",default:0}),MineAnimator.attributes.add("explosionEndFrame",{type:"number",default:1}),MineAnimator.attributes.add("width",{type:"number",default:1,description:"Number of frames wide"}),MineAnimator.attributes.add("height",{type:"number",default:1,description:"number of frames high"}),MineAnimator.attributes.add("frameRate",{type:"number",default:24,description:"playback frames per second"}),MineAnimator.attributes.add("visualType",{type:"string",enum:[{SpaceTrash:"SpaceTrash"},{Comet:"Comet"},{AsteroidField:"AsteroidField"},{Mine:"Mine"},{BlackHole:"BlackHole"},{WhiteDwarf:"WhiteDwarf"},{Ships:"Ships"}]}),MineAnimator.attributes.add("widthOffset",{type:"number",default:0}),MineAnimator.attributes.add("heightOffset",{type:"number",default:0}),MineAnimator.prototype.initialize=function(){this.materialAsset&&(this.material=this.materialAsset.resource),this.timer=1/this.frameRate,this.startFrame=this.idleStartFrame,this.endFrame=this.idleEndFrame,this.frame=this.startFrame,this.transform=new pc.Vec4,this.stopOnFinish=!1,this.stopped=!1,this.setInactiveEventName=obstacleSetInactivePrefix+this.entity.parent.name,this.dx=(1-this.widthOffset)/this.width,this.dy=(1-this.heightOffset)/this.height,this.app.on(playerObstacleFailure,function(t){t===this.visualType&&this.playExplosionAnim()},this),this.app.on(playerObstacleSuccess,function(t){t===this.visualType&&this.playExplosionAnim()},this),this.app.on(gameResetEvent,function(){this.resetGame()},this),this.app.on(this.setInactiveEventName,function(){this.resetAnimator()},this)},MineAnimator.prototype.update=function(t){this.timer-=t,this.timer<0&&(this.stopped||this.frame++,this.frame>=this.endFrame&&(this.stopOnFinish?(this.stopped=!0,this.app.fire(obstacleResetExternal,this.entity.parent),console.log(this.entity.parent.name)):this.frame=this.startFrame),this.updateMaterial(this.frame),this.timer=1/this.frameRate)},MineAnimator.prototype.updateMaterial=function(t){var e=t%this.width,i=Math.floor(t/this.width),a=this.entity.model.meshInstances;this.transform.set(this.dx,this.dy,e*this.dx,1-this.dy-i*this.dy),a[0].setParameter("texture_diffuseMapTransform",this.transform.data),a[0].setParameter("texture_emissiveMapTransform",this.transform.data),a[0].setParameter("texture_opacityMapTransform",this.transform.data)},MineAnimator.prototype.playExplosionAnim=function(){this.startFrame=this.explosionStartFrame,this.endFrame=this.explosionEndFrame,this.stopOnFinish=!0},MineAnimator.prototype.resetGame=function(){this.resetAnimator()},MineAnimator.prototype.resetAnimator=function(){this.startFrame=this.idleStartFrame,this.endFrame=this.idleEndFrame,this.stopOnFinish=!1,this.stopped=!1};var CharacterAnimator=pc.createScript("characterAnimator");CharacterAnimator.attributes.add("idleAnimation",{type:"entity"}),CharacterAnimator.attributes.add("deathEffect",{type:"entity"}),CharacterAnimator.attributes.add("novertrunnionEffect",{type:"entity"}),CharacterAnimator.attributes.add("rocketPunchEffect",{type:"entity"}),CharacterAnimator.attributes.add("heatShieldEffect",{type:"entity"}),CharacterAnimator.attributes.add("dingleArmEffect",{type:"entity"}),CharacterAnimator.prototype.initialize=function(){this.currentAnimation=this.idleAnimation;this.stuntButtonThreeEvent=buttonStateHeatShield,this.neutralStateEvent=statePrefix+stateNeutral,this.app.on(playerObstacleSuccess,function(t){switch(t){case visTypeWhiteDwarf:case visTypeBlackHole:this.playNovertrunnionEffect();break;case visTypeAsteroidField:case visTypeShips:this.playDingleArmEffect();break;case visTypeSpaceTrash:this.playRocketPunchEffect()}},this),this.app.on(this.stuntButtonThreeEvent,function(){console.log("heat shield triggered"),this.playHeatShieldEffect()},this),this.app.on(buttonStateDingleArm,function(){this.playIdleEffect()},this),this.app.on(buttonStateNovertrunnion,function(){this.playIdleEffect()},this),this.app.on(buttonStateRocketPunch,function(){this.playIdleEffect()},this),this.app.on(playerObstacleFailure,function(){this.playDeathEffect()},this),this.app.on(this.neutralStateEvent,function(){this.playIdleEffect()},this),this.app.on(gameResetEvent,function(){this.resetGame()},this),this.app.on(playerIdleAnim,function(){this.playIdleEffect()},this),this.once("destroy",this.onDestroy,this)},CharacterAnimator.prototype.onDestroy=function(){this.app.off(playerObstacleSuccess),this.app.off(buttonStateDingleArm),this.app.off(buttonStateNovertrunnion),this.app.off(buttonStateRocketPunch),this.app.off(playerObstacleFailure),this.app.off(this.neutralStateEvent),this.app.off(gameResetEvent),this.app.off(playerIdleAnim),this.app.off(this.stuntButtonThreeEvent)},CharacterAnimator.prototype.playIdleEffect=function(){this.turnOffAllEffects(),this.currentAnimation=this.idleAnimation,this.currentAnimation.enabled=!0,this.app.fire(playerChangeAnimState)},CharacterAnimator.prototype.playDeathEffect=function(){this.turnOffAllEffects(),this.idleAnimation.enabled=!0,this.currentAnimation=this.deathEffect,this.currentAnimation.enabled=!0,this.app.fire(playerChangeAnimState),console.log("player character death")},CharacterAnimator.prototype.playNovertrunnionEffect=function(){GameEnded||(this.turnOffAllEffects(),this.currentAnimation=this.novertrunnionEffect,this.currentAnimation.enabled=!0,this.app.fire(playerChangeAnimState))},CharacterAnimator.prototype.playRocketPunchEffect=function(){GameEnded||(this.turnOffAllEffects(),this.currentAnimation=this.rocketPunchEffect,this.currentAnimation.enabled=!0,this.app.fire(playerChangeAnimState))},CharacterAnimator.prototype.playHeatShieldEffect=function(){GameEnded?console.log("game has ended"):(this.turnOffAllEffects(),this.currentAnimation=this.heatShieldEffect,this.currentAnimation.enabled=!0,this.idleAnimation.enabled=!0,this.app.fire(playerChangeAnimState))},CharacterAnimator.prototype.playDingleArmEffect=function(){GameEnded||(this.turnOffAllEffects(),this.currentAnimation=this.dingleArmEffect,this.currentAnimation.enabled=!0,this.app.fire(playerChangeAnimState))},CharacterAnimator.prototype.turnOffAllEffects=function(){this.rocketPunchEffect.enabled=!1,this.dingleArmEffect.enabled=!1,this.heatShieldEffect.enabled=!1,this.novertrunnionEffect.enabled=!1,this.idleAnimation.enabled=!1,this.deathEffect.enabled=!1},CharacterAnimator.prototype.resetGame=function(){this.turnOffAllEffects(),this.playIdleEffect()};var PlayAnimationAtomic=pc.createScript("playAnimationAtomic");PlayAnimationAtomic.attributes.add("materialAsset",{type:"asset",assetType:"material"}),PlayAnimationAtomic.attributes.add("numFrames",{type:"number",default:1,description:"Number of frames to play before looping"}),PlayAnimationAtomic.attributes.add("startFrame",{type:"number",default:0,description:"frame to start animation at"}),PlayAnimationAtomic.attributes.add("endFrame",{type:"number",default:1}),PlayAnimationAtomic.attributes.add("width",{type:"number",default:1,description:"Number of frames wide"}),PlayAnimationAtomic.attributes.add("height",{type:"number",default:1,description:"number of frames high"}),PlayAnimationAtomic.attributes.add("frameRate",{type:"number",default:24,description:"playback frames per second"}),PlayAnimationAtomic.attributes.add("resetOnAnimStateChange",{type:"boolean"}),PlayAnimationAtomic.attributes.add("heightOffset",{type:"number",default:0}),PlayAnimationAtomic.attributes.add("widthOffset",{type:"number",default:0}),PlayAnimationAtomic.prototype.initialize=function(){this.app.on(gameResetEvent,function(){this.resetGame()},this),!0===this.resetOnAnimStateChange?(console.log("reset toggle on for "+this.entity.name),console.log("subscribing to "+playerChangeAnimState)):console.log("no reset"+this.resetOnAnimStateChange),this.resetOnAnimStateChange&&this.app.on(playerChangeAnimState,function(){this.resetAnimation()},this),this.materialAsset&&(this.material=this.materialAsset.resource),this.timer=1/this.frameRate,this.frame=this.startFrame,this.transform=new pc.Vec4,this.dx=(1-this.widthOffset)/this.width,this.dy=(1-this.heightOffset)/this.height},PlayAnimationAtomic.prototype.update=function(t){this.timer-=t,this.timer<0&&!this.stopped&&(this.frame++,this.frame==this.endFrame&&(this.stopped=!0,this.updateMaterial(this.frame)),this.updateMaterial(this.frame),this.timer=1/this.frameRate)},PlayAnimationAtomic.prototype.updateMaterial=function(t){var e=t%this.width,i=Math.floor(t/this.width),a=this.entity.model.meshInstances;this.transform.set(this.dx,this.dy,e*this.dx,1-this.dy-i*this.dy),a[0].setParameter("texture_diffuseMapTransform",this.transform.data),a[0].setParameter("texture_emissiveMapTransform",this.transform.data),a[0].setParameter("texture_opacityMapTransform",this.transform.data)},PlayAnimationAtomic.prototype.resetGame=function(){this.resetAnimation()},PlayAnimationAtomic.prototype.resetAnimation=function(){this.frame=this.startFrame,this.stopped=!1};var Videotexture=pc.createScript("videotexture");Videotexture.attributes.add("materials",{type:"asset",assetType:"material",array:!0}),Videotexture.attributes.add("videoAsset",{type:"asset",assetType:"audio"}),Videotexture.prototype.initialize=function(){this.videoStarted=!1,this.app.once(tutorialVideoStart,this.startTutorial,this)},Videotexture.prototype.update=function(t){!1!==this.videoStarted&&(this.upload=!this.upload,this.upload&&this.videoTexture.upload())},Videotexture.prototype.startTutorial=function(){var t=this.app,e=new pc.Texture(t.graphicsDevice,{format:pc.PIXELFORMAT_R5_G6_B5,autoMipmap:!1});e.minFilter=pc.FILTER_LINEAR,e.magFilter=pc.FILTER_LINEAR,e.addressU=pc.ADDRESS_CLAMP_TO_EDGE,e.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var i=document.createElement("video");i.addEventListener("canplay",function(t){e.setSource(i)}),i.addEventListener("ended",function(e){t.fire(tutorialVideoEnded)}),i.src=this.videoAsset.getFileUrl(),i.crossOrigin="anonymous",i.loop=!1,i.play();for(var a=0;a<this.materials.length;a++){var r=this.materials[a].resource;r.emissiveMap=e,r.update()}this.videoTexture=e,this.upload=!0,this.videoStarted=!0};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},KeyboardInput.prototype.onDestroy=function(){this.app.keyboard.off(pc.EVENT_KEYDOWN,this.onKeyDown,this)},KeyboardInput.prototype.onKeyDown=function(t){switch(t.key){case pc.KEY_1:this.app.fire(buttonStateNovertrunnion);break;case pc.KEY_2:this.app.fire(buttonStateRocketPunch);break;case pc.KEY_3:this.app.fire(buttonStateHeatShield);break;case pc.KEY_4:this.app.fire(buttonStateDingleArm)}};var FreeTextureMemory=pc.createScript("freeTextureMemory");FreeTextureMemory.attributes.add("assetName",{type:"string"}),FreeTextureMemory.attributes.add("loadOnStart",{type:"boolean",default:!0}),FreeTextureMemory.prototype.initialize=function(){var e=this.entity.model.meshInstances[0].material;if(null===e.diffuseMap&&this.loadOnStart){var t=this.app.assets.find(this.assetName);this.app.assets.load(t),t.ready(function(t){e.diffuseMap=t.resource,e.emissiveMap=t.resource,e.update()})}},FreeTextureMemory.prototype.postInitialize=function(){this.app.on(scenePreloadEvents,this.removeTextureFromMemory,this)},FreeTextureMemory.prototype.removeTextureFromMemory=function(){var e=this.entity.model.meshInstances[0].material,t=(e.diffuseMap,this.app.assets.find(this.assetName));if(null!==t&&void 0!==t){var r=t.getFileUrl();e.diffuseMap=null,e.emissiveMap=null,e.update(),this.app.loader.clearCache(r,t.type),t.unload()}};var EventsUnsubscribe=pc.createScript("eventsUnsubscribe");EventsUnsubscribe.prototype.initialize=function(){this.app.off(scenePreloadEvents)},EventsUnsubscribe.prototype.update=function(e){};var Gui=pc.createScript("gui");Gui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Gui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Gui.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource,this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource,document.body.appendChild(this.div);var e=["Saab","Volvo","BMW"],i=document.getElementById("list"),n=document.createElement("ul");i.appendChild(n);for(var s=0;s<e.length;s++){var d=document.createElement("li");n.appendChild(d),d.innerHTML=d.innerHTML+e[s]}this.bindEvents()},Gui.prototype.update=function(t){},Gui.prototype.bindEvents=function(){this.div.querySelector(".button")};var LoadHomeScene=pc.createScript("loadHomeScene");LoadHomeScene.attributes.add("sceneID",{type:"string",default:"0",title:"Scene ID to load"}),LoadHomeScene.prototype.initialize=function(){this.app.off(loadCharacterSelect),this.app.off(loadNextScene)},LoadHomeScene.prototype.postInitialize=function(){var e=this;this.app.on(loadNextScene,function(){setTimeout(function(){e.changeScene()},1e3)},this),this.app.on(characterSelectedEvent,function(e){characterToLoad=e},this),this.loadingScene=!1,characterToLoad=startingCharacter};var FreeTextureCharacterSelect=pc.createScript("freeTextureCharacterSelect");FreeTextureCharacterSelect.attributes.add("characterName",{type:"string",enum:[{rex:"characterRex"},{jaiyana:"characterJaiyana"},{captainCode:"characterCaptainCode"},{edgeX:"characterEdgeX"},{robbit:"characterRobbit"}]}),FreeTextureCharacterSelect.attributes.add("assetName",{type:"string"}),FreeTextureCharacterSelect.prototype.initialize=function(){this.app.off(scenePreloadEvents),this.app.off(characterSelectedEvent),this.characterName===startingCharacter?this.unloadFlag=!1:unloadFlag=!0,this.loadTexture()},FreeTextureCharacterSelect.prototype.postInitialize=function(){this.app.on(scenePreloadEvents,function(){!0===this.unloadFlag&&this.unloadTexture()},this),this.app.on(characterSelectedEvent,this.setUnloadFlag,this)},FreeTextureCharacterSelect.prototype.setUnloadFlag=function(e){e===this.characterName?this.unloadFlag=!1:this.unloadFlag=!0},FreeTextureCharacterSelect.prototype.loadTexture=function(){var e=this.entity.model.meshInstances[0].material;if(null===e.diffuseMap){var t=this.app.assets.find(this.assetName);this.app.assets.load(t),t.ready(function(t){e.diffuseMap=t.resource,e.update()})}},FreeTextureCharacterSelect.prototype.unloadTexture=function(){var e=this.entity.model.meshInstances[0].material,t=(e.diffuseMap,this.app.assets.find(this.assetName)),a=t.getFileUrl();e.diffuseMap=null,e.update(),this.app.loader.clearCache(a,t.type),t.unload()};var PlayerSoundManager=pc.createScript("soundManager");PlayerSoundManager.attributes.add("heatShieldClip",{type:"string",default:"heatShield"}),PlayerSoundManager.attributes.add("novertrunnionClip",{type:"string",default:"novertrunnion"}),PlayerSoundManager.attributes.add("dingleArmClip",{type:"string",default:"dingleArm"}),PlayerSoundManager.attributes.add("rocketPunchClip",{type:"string",default:"rocketPunch"}),PlayerSoundManager.attributes.add("deathClip",{type:"string",default:"death"}),PlayerSoundManager.prototype.initialize=function(){this.soundNone="none",this.currentSound=this.soundNone,this.app.on(buttonStateHeatShield,this.playHeatShield,this),this.app.on(statePrefix+stateNeutral,this.stopSound,this),this.app.on(playerObstacleFailure,this.playDeathSound,this),this.app.on(playerObstacleSuccess,function(t){switch(t){case visTypeWhiteDwarf:case visTypeBlackHole:this.playNovertrunnion();break;case visTypeAsteroidField:case visTypeShips:this.playDingleArm()}},this),this.once("destroy",this.onDestroy,this)},PlayerSoundManager.prototype.playHeatShield=function(){this.stopSound(),this.entity.sound.play(this.heatShieldClip),this.currentSound=this.heatShieldClip},PlayerSoundManager.prototype.playNovertrunnion=function(){this.stopSound(),this.entity.sound.play(this.novertrunnionClip),this.currentSound=this.novertrunnionClip},PlayerSoundManager.prototype.playDingleArm=function(){this.stopSound(),this.entity.sound.play(this.dingleArmClip),this.currentSound=this.dingleArmClip},PlayerSoundManager.prototype.stopSound=function(){this.entity.sound.stop(),this.currentSound=this.soundNone},PlayerSoundManager.prototype.playDeathSound=function(){this.entity.sound.stop(),this.entity.sound.play(this.deathClip),this.currentSound=this.deathClip},PlayerSoundManager.prototype.onDestroy=function(){this.app.off(buttonStateHeatShield),this.app.off(statePrefix+stateNeutral),this.app.off(playerObstacleFailure),this.app.off(playerObstacleSuccess)};var ObstacleSoundManager=pc.createScript("obstacleSoundManager");ObstacleSoundManager.attributes.add("trashImpactClip",{type:"string",default:"trashImpact"}),ObstacleSoundManager.attributes.add("mineExplosionClip",{type:"string",default:"mineExplosion"}),ObstacleSoundManager.prototype.initialize=function(){this.app.on(playerHitEvent,this.playObstacleSound,this),this.once("destroy",this.onDestroy,this)},ObstacleSoundManager.prototype.playObstacleSound=function(t,e){if(e===visTypeSpaceTrash)this.entity.sound.play(this.trashImpactClip);else if(e===visTypeMine){var a=this;setTimeout(function(){a.entity.sound.play(a.mineExplosionClip)},1e3)}},ObstacleSoundManager.prototype.onDestroy=function(){this.app.off(playerHitEvent)};var StartingLineAnimator=pc.createScript("startingLineAnimator");StartingLineAnimator.attributes.add("width",{type:"number",default:1}),StartingLineAnimator.attributes.add("height",{type:"number",default:1}),StartingLineAnimator.attributes.add("frameRate",{type:"number",default:24,description:"playback frames per second"}),StartingLineAnimator.attributes.add("widthOffset",{type:"number",default:0}),StartingLineAnimator.attributes.add("heightOffset",{type:"number",default:0}),StartingLineAnimator.prototype.initialize=function(){this.materialAsset&&(this.material=this.materialAsset.resource),this.startFrame=-1,this.endFrame=this.width*this.height-1,this.frame=this.startFrame,this.transform=new pc.Vec4,this.dx=(1-this.widthOffset)/this.width,this.dy=(1-this.heightOffset)/this.height,this.app.on(countdownTickEvent,function(t){this.updateFrame()},this),this.app.on(gameResetEvent,function(){this.resetGame()},this),this.once("destroy",this.onDestroy,this),this.updateMaterial(0)},StartingLineAnimator.prototype.updateFrame=function(){this.frame++,this.updateMaterial(this.frame)},StartingLineAnimator.prototype.updateMaterial=function(t){var e=2;switch(t){case 1:e=2;break;case 2:e=1;break;case 3:e=0}var i=e%this.width,a=Math.floor(e/this.width);console.log(this.entity.name);var r=this.entity.model.meshInstances;this.transform.set(this.dx,this.dy,i*this.dx,1-this.dy-a*this.dy),r[0].setParameter("texture_diffuseMapTransform",this.transform.data),r[0].setParameter("texture_emissiveMapTransform",this.transform.data),r[0].setParameter("texture_opacityMapTransform",this.transform.data)},StartingLineAnimator.prototype.resetGame=function(){this.frame=this.startFrame,this.updateMaterial(0)},StartingLineAnimator.prototype.onDestroy=function(){this.app.off(countdownTickEvent),this.app.off(gameResetEvent)};var StartTutorialButton=pc.createScript("startTutorialButton");StartTutorialButton.prototype.initialize=function(){this.tutorialStarted=!1,this.app.mouse.once(pc.EVENT_MOUSEDOWN,this.onSelect,this),this.app.mouse.once(pc.EVENT_TOUCHSTART,this.onSelect,this)},StartTutorialButton.prototype.onSelect=function(){this.tutorialStarted||(this.app.fire(tutorialVideoStart),this.tutorialStarted=!0)};var HideButton=pc.createScript("hideButton");HideButton.prototype.initialize=function(){this.app.on(gameOverEvent,function(){this.entity.enabled=!0},this),this.app.on(gameResetEvent,function(){this.entity.enabled=!1},this)},HideButton.prototype.postInitialize=function(){this.entity.enabled=!1};var LoadCharacterSelect=pc.createScript("loadCharacterSelect");LoadCharacterSelect.attributes.add("sceneID",{type:"string",default:"589797",title:"Scene ID to load"}),LoadCharacterSelect.prototype.initialize=function(){this.app.off(loadNextScene),this.app.off(scenePreloadEvents),this.sceneToLoad=this.sceneID},LoadCharacterSelect.prototype.postInitialize=function(){var e=this;this.app.on(loadNextScene,function(t){0!==t&&(this.sceneToLoad=t),setTimeout(function(){e.changeScene()},1e3)},this),this.loadingScene=!1},LoadCharacterSelect.prototype.changeScene=function(){console.log("changing scenes");var e=this.app.root.findByName("Root");this.app.fire(scenePreloadEvents),this.loadNewScene(this.sceneToLoad,function(){e.destroy()})},LoadCharacterSelect.prototype.loadNewScene=function(e,t){var o=e+".json";console.log("loading scene"),this.app.loadSceneHierarchy(o,function(e,o){e?console.log(e):t(o)})};var Leaderboard=pc.createScript("leaderboard");Leaderboard.attributes.add("url",{type:"string",default:"http://mediarelationsmailer.com/"}),Leaderboard.attributes.add("postScoreUrl",{type:"string",default:"http://localhost/SW_Scoreset/sw_postHighScore.php"}),Leaderboard.attributes.add("hasValidUrl",{type:"boolean",default:!1}),Leaderboard.prototype.initialize=function(){if(this.app.on(scoreSubmitTrigged,function(e){this.submitScore(e)},this),this.personalHighScore=0,localStorage){var e=localStorage.getItem(highScoreName);null!==e&&(this.personalHighScore=parseFloat(e))}console.log("personal high score is "+this.personalHighScore)},Leaderboard.prototype.submitScore=function(e){if(this.hasValidUrl){console.log("write score "+this.personalHighScore);var r=this;pc.http.post(this.postScoreUrl,{name:e,score:this.personalHighScore},function(e,o){console.log(o),localStorage&&localStorage.setItem(highScoreName,0),r.fireShowLeaderboard(),r.getScores()}),console.log("show leaderboard")}},Leaderboard.prototype.getScores=function(){if(this.hasValidUrl){var e=this;pc.http.get(this.url,function(r,o){if(null!==o){o=o.trim();for(var t=o.split("||"),a=t.length/2>maxScoresToDisplay?2*maxScoresToDisplay:t.length,i=0,s=0;s<a;s+=2){if(!t[s].trim()||0===t[s].length)return;e.fireLeaderboardEntryUpdate(++i,t[s],t[s+1])}}})}},Leaderboard.prototype.fireShowLeaderboard=function(){this.app.fire(showLeaderboard)},Leaderboard.prototype.fireLeaderboardEntryUpdate=function(e,r,o){this.app.fire(updateLeaderboardEntry,e,r,o)},Leaderboard.prototype.onDestroy=function(){};var LetterKey=pc.createScript("letterKey");LetterKey.attributes.add("textDisplay",{type:"entity"}),LetterKey.attributes.add("letter",{type:"string",default:"A"}),LetterKey.prototype.initialize=function(){this.textDisplay.element.text=this.letter,this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this)},LetterKey.prototype.onPress=function(){this.textDisplay.element.color=pressedColor,this.entity.element.color=pressedColor,this.app.fire(letterKeyPressed,this.letter)},LetterKey.prototype.onRelease=function(){this.textDisplay.element.color=releasedColor,this.entity.element.color=releasedColor};var NameInput=pc.createScript("nameInput");NameInput.attributes.add("nameText",{type:"entity"}),NameInput.prototype.initialize=function(){this.nameString="",this.app.on(letterKeyPressed,function(t){this.addLetter(t)},this),this.app.on(nameSubmitted,function(){""===this.nameString&&(this.nameString="000"),this.app.fire(scoreSubmitTrigged,this.nameString)},this)},NameInput.prototype.addLetter=function(t){if(this.nameString+=t,4===this.nameString.length){var e=this.nameString[1]+this.nameString[2]+this.nameString[3];this.nameString=e}this.nameText.element.text=this.nameString};var SubmitButton=pc.createScript("submitButton");SubmitButton.attributes.add("textDisplay",{type:"entity"}),SubmitButton.prototype.initialize=function(){this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this)},SubmitButton.prototype.onPress=function(){this.entity.element.color=pressedColor,this.textDisplay.element.color=pressedColor},SubmitButton.prototype.onRelease=function(){this.entity.element.color=releasedColor,this.textDisplay.element.color=releasedColor,this.app.fire(nameSubmitted)};var Uiviews=pc.createScript("uiviews");Uiviews.attributes.add("submitNameView",{type:"entity"}),Uiviews.attributes.add("highScoreView",{type:"entity"}),Uiviews.prototype.initialize=function(){this.app.on(nameSubmitted,this.nameSubmitted,this),this.app.on(showLeaderboard,this.showLeaderboard,this)},Uiviews.prototype.nameSubmitted=function(){this.submitNameView.enabled=!1},Uiviews.prototype.showLeaderboard=function(){this.highScoreView.enabled=!0};var ScoreDisplay=pc.createScript("scoreDisplay");ScoreDisplay.attributes.add("nameText",{type:"entity"}),ScoreDisplay.attributes.add("scoreText",{type:"entity"}),ScoreDisplay.attributes.add("rank",{type:"number",default:0}),ScoreDisplay.prototype.initialize=function(){this.app.on(updateLeaderboardEntry,function(t,e,a){this.rank===t&&(this.nameText.element.text=e,this.scoreText.element.text=a)},this)},ScoreDisplay.prototype.onDestroy=function(){this.app.off(updateLeaderboardEntry)};